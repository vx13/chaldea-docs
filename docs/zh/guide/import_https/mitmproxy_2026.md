# FGO 数据抓取：自动化方案 (2026版)

::: info 特别声明
以下关于法律授权、版权限制及免责条款的说明，**仅适用于本页面介绍的“FGO 登录数据自动化抓取工具（含 run.bat 及 fgo_cap.py）”及其配套说明**，不代表本站或 Chaldea 项目组的立场与声明。
:::

> **[ 法律声明与授权说明 ]**
>
> * **项目独立性**：本脚本及相关工具为独立开发的第三方辅助工具，其权属**不属于**《Fate/Grand Order》官方及其关联公司，亦**不属于** Chaldea 项目组。
> * **技术背景**：本工具的核心逻辑、环境自检流程及本说明文档均借助 **AI (人工智能)** 协作设计与编写。
> * **版权许可**：本工具**未设任何版权限制**。开发者欢迎并鼓励任何个人或组织对代码进行学习、修改、二次开发、功能扩展以及在社区内进行推广与分发。
> * **免责条款**：本工具仅供技术交流与学习使用，旨在优化用户数据管理体验。开发者及 AI 协作方不对因使用本工具导致的任何直接或间接后果（如账号异常、隐私泄露等）承担法律责任。用户应在遵守当地法律法规及游戏服务协议的前提下使用。
> * **安全提示**：抓取到的原始登录数据包含敏感凭据，**请务必妥善保管，切勿发送给他人**。
---

## 0. 工具下载与准备

根据您的环境选择以下任一方式获取工具：

### 途径 A：精简包（不含引擎）
1. **脚本**: 下载本站分流的 [`fgo_cap.zip`](http://url) 并解压。
2. **引擎**: 下载 [mitmproxy 12.2.1 免安装版](https://downloads.mitmproxy.org/12.2.1/mitmproxy-12.2.1-windows-x86_64.zip) ，并解压其中的 **`mitmdump.exe`** 到脚本同级目录，或自行通过 pip 安装。

### 途径 B：懒人包（含引擎）
包含封装好的执行环境。
* **下载链接**: [百度网盘](https://pan.baidu.com/s/1EBaW7WSD_TAqpucWSQIBzQ?pwd=kedi) （提取码: `kedi`）

---

## 1. 模拟器准备 (MuMu 12)

请务必完成以下设置并**重启模拟器**，否则脚本将无法执行底层操作：

| 设置项 | 路径 | 设定值 |
| :--- | :--- | :--- |
| **Root 权限** | [设备设置] - [其他] | **开启** |
| **系统盘可写** | [设备设置] - [磁盘] | 选择 **“可写系统盘”** |
| **ADB 调试** | [设备设置] - [其他] | 选择 **“开启本地连接”** |

---

## 2. 运行与抓取流程

1. **启动脚本**：双击运行 **`run.bat`**，等待自检完成并提示 `[🚀] 正在监听...`。
2. **登录游戏**：在模拟器中启动 FGO，点击进入游戏直到看到“地球仪”或“活动公告”。
3. **自动结束**：捕获成功后窗口会提示 `[🎯] 捕获成功!` 并**自动完成清理后关闭**。此时数据已存入剪贴板。

::: danger 注意事项：中途退出与断网恢复
* **正确退出**：若需手动停止，请务必在窗口内按 **`Ctrl + C`**。**请勿**直接点击窗口右上角的红色 [X] 关闭。
* **断网修复**：若因异常关闭导致模拟器无法上网，请**再次运行 `run.bat` 并按 `Ctrl + C` 正常退出**，或手动进入模拟器 [Wi-Fi设置] 将 [代理] 修改为 **“无”**。
:::

---

## 3. 导入 Chaldea

1. 打开 **Chaldea** 客户端。
2. 进入数据导入页面，选择 **[导入HTTPS抓包数据]** -> **[从剪切板导入]** 即可完成。

---

## 4. 脚本工作流程

| 步骤 | 执行逻辑 |
| :--- | :--- |
| **证书生成** | 检索用户目录 CA 证书；若缺失，后台静默启动 `mitmdump` 生成证书。 |
| **ADB 查找** | 通过检索 `MuMuNxDevice` 进程的文件路径，锁定并调用模拟器安装目录下的原生 `adb.exe`。 |
| **ADB 连接** | 顺序执行 `kill-server` 与 `start-server` 重置服务；通过 `127.0.0.1:5555` 握手建立连接。 |
| **证书注入** | 基于 **MD5 散列值**比对用户目录与模拟器系统证书内容；证书不存在或散列值不一致时上传覆盖。 |
| **代理配置** | 自动解析宿主机局域网活跃 IP；通过 `adb shell settings` 接口将代理参数注入模拟器全局配置。 |
| **抓包分析** | 匹配特定接口后缀 `_key=toplogin`；提取响应原始文本并通过系统管道写入 Windows 剪贴板。 |
| **代理清理** | 监听捕获成功或 `Ctrl + C` 中断信号；将模拟器全局代理重置为关闭状态（`:0`）以还原网络环境。 |
